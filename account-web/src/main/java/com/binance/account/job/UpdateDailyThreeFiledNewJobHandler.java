package com.binance.account.job;

import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

import javax.annotation.Resource;

import com.binance.account.data.entity.security.UserSecurity;
import com.binance.account.data.mapper.security.UserSecurityMapper;
import com.google.common.collect.Maps;
import org.apache.commons.collections.CollectionUtils;
import org.apache.skywalking.apm.toolkit.trace.Trace;
import org.springframework.stereotype.Component;

import com.binance.account.data.entity.user.User;
import com.binance.account.data.entity.user.UserInfo;
import com.binance.account.data.mapper.user.UserInfoMapper;
import com.binance.account.data.mapper.user.UserMapper;
import com.binance.master.constant.Constant;
import com.binance.master.old.data.account.OldUserDataMapper;
import com.binance.master.old.models.account.OldUserData;
import com.binance.master.utils.BitUtils;
import com.binance.master.utils.JsonUtils;
import com.binance.master.utils.StringUtils;
import com.binance.master.utils.TrackingUtils;
import com.google.common.collect.Lists;
import com.xxl.job.core.biz.model.ReturnT;
import com.xxl.job.core.handler.IJobHandler;
import com.xxl.job.core.handler.annotation.JobHandler;

import lombok.extern.log4j.Log4j2;

/**
 * Created by yangyang on 2019/6/17.
 */
@Log4j2
@JobHandler(value = "updateDailyThreeFiledNewJobHandler")
@Component
public class UpdateDailyThreeFiledNewJobHandler extends IJobHandler {
    private static final List<Long> userIdList = Lists.newArrayList(10000069L, 10010167L, 10010336L, 10010587L, 10010602L, 10010925L, 10011087L,
            10011356L, 10011668L, 10011906L, 10012057L, 10012110L, 10012203L, 10012678L, 10012771L, 10013336L, 10013339L, 10013680L, 10013836L,
            10013876L, 10015663L, 10016601L, 10016761L, 10017173L, 10017399L, 10017871L, 10018220L, 10018239L, 10018287L, 10018712L, 10018739L,
            10019589L, 10019953L, 10020118L, 10020159L, 10020621L, 10020655L, 10021226L, 10021231L, 10022088L, 10022738L, 10022856L, 10023239L,
            10023795L, 10023802L, 10023859L, 10023885L, 10025099L, 10025318L, 10025792L, 10025918L, 10026561L, 10026650L, 10026885L, 10027339L,
            10027826L, 10027829L, 10027967L, 10027991L, 10028202L, 10028292L, 10028557L, 10028880L, 10028977L, 10029109L, 10029897L, 10030525L,
            10030672L, 10030855L, 10030868L, 10030935L, 10030972L, 10031091L, 10031235L, 10031558L, 10031752L, 10031829L, 10031889L, 10031935L,
            10032010L, 10032171L, 10032316L, 10032362L, 10032717L, 10032792L, 10032836L, 10033095L, 10033308L, 10033507L, 10033515L, 10033619L,
            10033671L, 10033711L, 10033926L, 10033983L, 10035135L, 10035290L, 10035387L, 10035515L, 10035518L, 10035677L, 10035763L, 10035820L,
            10035915L, 10035959L, 10036276L, 10036296L, 10036760L, 10036781L, 10036931L, 10037000L, 10037166L, 10037188L, 10037211L, 10037395L,
            10037680L, 10037933L, 10038070L, 10038071L, 10038197L, 10038608L, 10038735L, 10038781L, 10038856L, 10039061L, 10039113L, 10039975L,
            10050198L, 10050220L, 10050607L, 10050627L, 10050755L, 10050757L, 10050821L, 10051023L, 10051078L, 10051085L, 10051132L, 10051279L,
            10051379L, 10051719L, 10051752L, 10051822L, 10052007L, 10052035L, 10052056L, 10052162L, 10052313L, 10052351L, 10052685L, 10052795L,
            10052806L, 10052917L, 10053606L, 10053851L, 10053963L, 10055082L, 10055123L, 10055139L, 10055300L, 10055397L, 10055670L, 10055935L,
            10056000L, 10056026L, 10056502L, 10056699L, 10056921L, 10056968L, 10057153L, 10057217L, 10057353L, 10057771L, 10057801L, 10057815L,
            10057906L, 10057908L, 10058013L, 10058100L, 10058162L, 10058180L, 10058225L, 10058298L, 10058369L, 10058371L, 10058518L, 10058586L,
            10058623L, 10059021L, 10059123L, 10059169L, 10059218L, 10059390L, 10059708L, 10059753L, 10059879L, 10059970L, 10060159L, 10060168L,
            10060205L, 10060219L, 10060811L, 10060953L, 10061158L, 10061583L, 10061619L, 10061665L, 10061698L, 10061852L, 10061978L, 10062051L,
            10062056L, 10062162L, 10062213L, 10062330L, 10062373L, 10062563L, 10062626L, 10062926L, 10062933L, 10062939L, 10063028L, 10063039L,
            10063139L, 10063160L, 10063220L, 10063637L, 10063807L, 10063951L, 10065067L, 10065092L, 10065306L, 10065392L, 10065788L, 10065852L,
            10065989L, 10066016L, 10066165L, 10066369L, 10066787L, 10067057L, 10067250L, 10067268L, 10067383L, 10067578L, 10067683L, 10067689L,
            10067730L, 10067801L, 10067827L, 10067829L, 10067892L, 10068061L, 10068088L, 10068135L, 10068263L, 10068750L, 10068817L, 10068961L,
            10069265L, 10070092L, 10071203L, 10071599L, 10071655L, 10071933L, 10072235L, 10073186L, 10073516L, 10073702L, 10075173L, 10075297L,
            10075507L, 10075520L, 10075850L, 10075936L, 10076056L, 10076176L, 10077618L, 10077780L, 10078098L, 10078250L, 10078276L, 10078613L,
            10079616L, 10079965L, 10080173L, 10080927L, 10081516L, 10082973L, 10083232L, 10085701L, 10085761L, 10086219L, 10086597L, 10086637L,
            10087008L, 10088139L, 10088307L, 10089239L, 10089560L, 10089722L, 10089801L, 10090029L, 10090078L, 10090392L, 10091153L, 10091200L,
            10091886L, 10091938L, 10092100L, 10092881L, 10092989L, 10093163L, 10093532L, 10093589L, 10093706L, 10093773L, 10093802L, 10093916L,
            10093953L, 10095239L, 10095379L, 10095568L, 10095656L, 10095693L, 10096005L, 10096075L, 10096860L, 10096933L, 10098676L, 10098828L,
            10099090L, 10099331L, 10099670L, 10100202L, 10100386L, 10100696L, 10101027L, 10101085L, 10101197L, 10101711L, 10101833L, 10102232L,
            10102605L, 10105522L, 10105605L, 10106235L, 10106579L, 10107162L, 10107861L, 10107996L, 10108185L, 10109066L, 10109075L, 10109729L,
            10109838L, 10110518L, 10110636L, 10110689L, 10111876L, 10112271L, 10112501L, 10112693L, 10112720L, 10112919L, 10112967L, 10115116L,
            10115311L, 10115921L, 10116058L, 10116152L, 10116200L, 10116255L, 10116325L, 10116558L, 10116719L, 10116788L, 10117065L, 10117122L,
            10117250L, 10117605L, 10117765L, 10117786L, 10117860L, 10117871L, 10117922L, 10118080L, 10118260L, 10119618L, 10119662L, 10119937L,
            10120023L, 10120288L, 10120521L, 10120571L, 10120573L, 10120608L, 10120622L, 10120729L, 10120773L, 10120950L, 10121090L, 10121125L,
            10121733L, 10121875L, 10121953L, 10122168L, 10123793L, 10125001L, 10125016L, 10125055L, 10125625L, 10126080L, 10126373L, 10126985L,
            10127312L, 10127315L, 10127506L, 10128193L, 10129028L, 10129088L, 10129266L, 10129280L, 10129355L, 10129399L, 10130221L, 10130302L,
            10130585L, 10130685L, 10130706L, 10130870L, 10131151L, 10131668L, 10132927L, 10133059L, 10133326L, 10133910L, 10135001L, 10135773L,
            10135891L, 10135918L, 10136179L, 10136513L, 10136720L, 10137057L, 10137333L, 10137716L, 10137900L, 10138581L, 10138589L, 10138678L,
            10138791L, 10139581L, 10139890L, 10150268L, 10150796L, 10150810L, 10150829L, 10150986L, 10150999L, 10151287L, 10151329L, 10151578L,
            10151952L, 10151965L, 10152023L, 10152257L, 10152362L, 10152783L, 10153511L, 10153872L, 10153886L, 10153936L, 10155177L, 10155288L,
            10155289L, 10155318L, 10155756L, 10155857L, 10155961L, 10156077L, 10156209L, 10156278L, 10156692L, 10156926L, 10157276L, 10157689L,
            10157861L, 10158663L, 10158721L, 10158739L, 10158906L, 10159218L, 10160058L, 10160160L, 10160252L, 10160360L, 10160830L, 10161200L,
            10161560L, 10161769L, 10161919L, 10162295L, 10162396L, 10162735L, 10163061L, 10163159L, 10163218L, 10163785L, 10163972L, 10165008L,
            10165067L, 10165185L, 10165396L, 10165522L, 10165703L, 10166837L, 10166859L, 10166997L, 10167385L, 10167737L, 10168063L, 10168500L,
            10168618L, 10168969L, 10169067L, 10169318L, 10169762L, 10170538L, 10170691L, 10170797L, 10170902L, 10171060L, 10171067L, 10171192L,
            10171778L, 10171957L, 10172502L, 10172891L, 10173100L, 10173319L, 10173560L, 10175080L, 10175295L, 10176361L, 10176670L, 10176728L,
            10177019L, 10177213L, 10177672L, 10178098L, 10178201L, 10178217L, 10178383L, 10179260L, 10179355L, 10179393L, 10179518L, 10179918L,
            10180037L, 10180355L, 10180360L, 10180528L, 10180657L, 10180969L, 10181537L, 10181791L, 10182211L, 10182303L, 10182335L, 10183108L,
            10183382L, 10183961L, 10185009L, 10185065L, 10185586L, 10185855L, 10186592L, 10186759L, 10187110L, 10187877L, 10188277L, 10188378L,
            10188629L, 10189112L, 10189600L, 10189903L, 10190110L, 10190187L, 10190310L, 10190683L, 10191007L, 10191076L, 10191097L, 10191360L,
            10191396L, 10191539L, 10191958L, 10191971L, 10192353L, 10192559L, 10193155L, 10193309L, 10193585L, 10193962L, 10195230L, 10195589L,
            10195831L, 10196163L, 10196338L, 10196628L, 10197367L, 10197633L, 10198028L, 10198807L, 10198902L, 10198919L, 10199022L, 10200006L,
            10200889L, 10200903L, 10201705L, 10201875L, 10202017L, 10202103L, 10202176L, 10202271L, 10202539L, 10203018L, 10203117L, 10203295L,
            10203299L, 10203306L, 10203578L, 10205087L, 10205335L, 10205386L, 10207065L, 10207218L, 10207355L, 10207585L, 10207686L, 10207815L,
            10207868L, 10208719L, 10209181L, 10209275L, 10209336L, 10209858L, 10210506L, 10210557L, 10210582L, 10211061L, 10211080L, 10211123L,
            10211252L, 10212565L, 10213569L, 10213703L, 10215038L, 10215580L, 10216659L, 10217077L, 10217089L, 10217125L, 10217177L, 10217278L,
            10218797L, 10218816L, 10219762L, 10219775L, 10220525L, 10220718L, 10220981L, 10221163L, 10221938L, 10221939L, 10222287L, 10222966L,
            10223281L, 10223295L, 10223572L, 10223686L, 10225055L, 10227230L, 10227689L, 10227830L, 10228025L, 10228103L, 10228326L, 10229627L,
            10229666L, 10229671L, 10230176L, 10230325L, 10230677L, 10230733L, 10230789L, 10230807L, 10232509L, 10233023L, 10235028L, 10235365L,
            10236330L, 10237070L, 10237075L, 10237259L, 10238268L, 10238723L, 10238952L, 10239570L, 10250002L, 10250333L, 10251328L, 10251511L,
            10251603L, 10251733L, 10252583L, 10253093L, 10253282L, 10253893L, 10255181L, 10255750L, 10255893L, 10256387L, 10256820L, 10257563L,
            10257829L, 10258009L, 10258078L, 10258502L, 10258982L, 10259611L, 10259763L, 10259956L, 10260985L, 10262011L, 10262187L, 10262833L,
            10265117L, 10266228L, 10266322L, 10266813L, 10267920L, 10267991L, 10268083L, 10268118L, 10268625L, 10269560L, 10271072L, 10272229L,
            10272670L, 10273188L, 10275829L, 10275850L, 10275867L, 10276122L, 10276203L, 10276575L, 10276966L, 10277868L, 10277939L, 10278573L,
            10278670L, 10278968L, 10279215L, 10279551L, 10286260L, 10291715L, 10291759L, 10291852L, 10292033L, 10298055L, 10315136L, 10319907L,
            10322389L, 10322601L, 10322672L, 10322679L, 10322852L, 10323905L, 10323906L, 10332625L, 10332659L, 10333711L, 10338562L, 10338977L,
            10352889L, 10357929L, 10362651L, 10363578L, 10377809L, 10379752L, 10389818L, 10393272L, 10520928L, 10525910L, 10527197L, 10529986L,
            10597015L, 10598582L, 10613099L, 10651136L, 10667897L, 10699057L, 10699308L, 10699353L, 10699372L, 10699557L, 10699569L, 10699573L,
            10699633L, 10699665L, 10699682L, 10699868L, 10699869L, 10700233L, 10701537L, 10702016L, 10702257L, 10702658L, 10702807L, 10702815L,
            10703065L, 10703337L, 10705059L, 10705133L, 10705252L, 10706653L, 10706957L, 10707133L, 10707936L, 10711115L, 10712681L, 10713286L,
            10715706L, 10716510L, 10720828L, 10722195L, 10722580L, 10725092L, 10725518L, 10725739L, 10726277L, 10726281L, 10726529L, 10726907L,
            10727012L, 10727103L, 10727253L, 10729208L, 10729613L, 10730387L, 10731117L, 10731352L, 10731576L, 10732220L, 10732232L, 10732555L,
            10732567L, 10733098L, 10733189L, 10733980L, 10735309L, 10736087L, 10736096L, 10738365L, 10739898L, 10750011L, 10750297L, 10750605L,
            10750762L, 10750811L, 10751668L, 10752768L, 10752796L, 10753219L, 10755851L, 10755950L, 10756078L, 10756755L, 10756986L, 10757010L,
            10757261L, 10757329L, 10757563L, 10757735L, 10757773L, 10757891L, 10757893L, 10758207L, 10758552L, 10758778L, 10759822L, 10760053L,
            10760522L, 10761212L, 10761718L, 10765623L, 10765739L, 10765927L, 10766083L, 10766753L, 10767055L, 10767353L, 10767750L, 10767906L,
            10768533L, 10768677L, 10768926L, 10769587L, 10770229L, 10771578L, 10772710L, 10773295L, 10773729L, 10773912L, 10775058L, 10775517L,
            10776757L, 10776769L, 10776878L, 10777135L, 10777373L, 10777871L, 10777938L, 10778509L, 10778790L, 10779311L, 10779685L, 10779766L,
            10779970L, 10780111L, 10780261L, 10780296L, 10780900L, 10780957L, 10780979L, 10781283L, 10781378L, 10782071L, 10782783L, 10783105L,
            10783523L, 10783720L, 10783779L, 10783783L, 10783909L, 10785102L, 10785281L, 10785719L, 10785750L, 10786033L, 10786262L, 10786867L,
            10787565L, 10788285L, 10788787L, 10789238L, 10789500L, 10789906L, 10789920L, 10790128L, 10790338L, 10790363L, 10791152L, 10791187L,
            10791597L, 10791957L, 10792961L, 10793067L, 10793365L, 10793883L, 10793896L, 10795320L, 10795585L, 10795691L, 10795900L, 10796799L,
            10797108L, 10797289L, 10797987L, 10798359L, 10798376L, 10798709L, 10799096L, 10799260L, 10800060L, 10800086L, 10801032L, 10801068L,
            10801207L, 10802089L, 10802153L, 10802502L, 10802676L, 10802866L, 10803365L, 10805177L, 10805223L, 10805325L, 10805503L, 10805519L,
            10805589L, 10805651L, 10805676L, 10805708L, 10806116L, 10806192L, 10807510L, 10807987L, 10808026L, 10808367L, 10808726L, 10809305L,
            10810209L, 10811382L, 10813000L, 10813065L, 10813072L, 10813592L, 10813726L, 10813978L, 10815108L, 10815132L, 10816030L, 10816700L,
            10816739L, 10816950L, 10817118L, 10817251L, 10817656L, 10817939L, 10818162L, 10818568L, 10818656L, 10819015L, 10819155L, 10819972L,
            10819983L, 10820060L, 10820169L, 10820272L, 10821970L, 10822235L, 10822702L, 10825618L, 10825710L, 10825775L, 10826628L, 10826710L,
            10826786L, 10827376L, 10827383L, 10827565L, 10827670L, 10827992L, 10828137L, 10828158L, 10828173L, 10828583L, 10828913L, 10829181L,
            10829971L, 10830626L, 10833269L, 10833519L, 10833526L, 10835875L, 10835938L, 10836689L, 10838622L, 10838795L, 10839261L, 10850656L,
            10850778L, 10851523L, 10852291L, 10852763L, 10852999L, 10859296L, 10859360L, 10861871L, 10863271L, 10863686L, 10865126L, 10866281L,
            10866675L, 10866709L, 10867158L, 10867272L, 10867368L, 10868653L, 10868920L, 10869066L, 10869097L, 10869808L, 10870555L, 10870880L,
            10871078L, 10871079L, 10871298L, 10871895L, 10872279L, 10873065L, 10873937L, 10875561L, 10876706L, 10876880L, 10876957L, 10877097L,
            10877098L, 10878760L, 10879135L, 10879239L, 10879570L, 10879650L, 10879893L, 10880195L, 10880896L, 10881009L, 10881091L, 10881161L,
            10881356L, 10881992L, 10883086L, 10883116L, 10883273L, 10883550L, 10885097L, 10885560L, 10885725L, 10885785L, 10886318L, 10886995L,
            10888290L, 10888961L, 10889780L, 10892063L, 10892320L, 10892398L, 10892935L, 10893025L, 10893616L, 10893806L, 10895723L, 10896868L,
            10897128L, 10897956L, 10898755L, 10898856L, 10899000L, 10899255L, 10899526L, 10899880L, 10900106L, 10900318L, 10900391L, 10900738L,
            10901203L, 10901523L, 10902096L, 10902163L, 10906667L, 10907079L, 10907766L, 10908101L, 10908581L, 10908972L, 10909782L, 10910335L,
            10910970L, 10911301L, 10912053L, 10912057L, 10912120L, 10912896L, 10912921L, 10913502L, 10913777L, 10915117L, 10915535L, 10915556L,
            10916825L, 10917299L, 10917553L, 10917827L, 10918167L, 10918811L, 10918920L, 10919013L, 10919151L, 10920265L, 10920851L, 10921029L,
            10922057L, 10922122L, 10922620L, 10925099L, 10925128L, 10925135L, 10925505L, 10926017L, 10926581L, 10926651L, 10926715L, 10926723L,
            10927032L, 10927627L, 10929560L, 10929720L, 10929721L, 10932160L, 10932352L, 10932727L, 10935166L, 10935256L, 10935603L, 10935851L,
            10951553L, 10952227L, 10952362L, 10953086L, 10953880L, 10958808L, 10958856L, 10960705L, 10960886L, 10962928L, 10965601L, 10966057L,
            10966079L, 10966110L, 10966971L, 10971103L, 10972022L, 10975600L, 10975865L, 10977316L, 10980781L, 10982738L, 10986337L, 10987388L,
            10990256L, 10990399L, 10991111L, 10991812L, 10992363L, 10993236L, 10996526L, 10997012L, 11000003L, 11001005L, 11001962L, 11001976L,
            11003163L, 11003636L, 11008582L, 11008590L, 11008625L, 11008638L, 11010088L, 11010658L, 11012326L, 11012557L, 11015778L, 11016305L,
            11016799L, 11017393L, 11017926L, 11017971L, 11021172L, 11026535L, 11027583L, 11032795L, 11033593L, 11035832L, 11037100L, 11038508L,
            11050537L, 11051828L, 11052509L, 11053128L, 11053217L, 11055097L, 11055253L, 11055559L, 11055566L, 11056373L, 11056788L, 11057963L,
            11058837L, 11059711L, 11060008L, 11060585L, 11060826L, 11061029L, 11061190L, 11061203L, 11061595L, 11062185L, 11062276L, 11062970L,
            11063860L, 11063967L, 11067032L, 11067290L, 11067837L, 11069911L, 11070082L, 11070087L, 11071398L, 11071559L, 11071923L, 11072029L,
            11073158L, 11073875L, 11075397L, 11075788L, 11076277L, 11076375L, 11079776L, 11080797L, 11081711L, 11082252L, 11082937L, 11085722L,
            11086358L, 11086523L, 11088529L, 11089378L, 11091729L, 11092800L, 11093500L, 11095080L, 11095525L, 11095595L, 11095730L, 11096207L,
            11096239L, 11098252L, 11100238L, 11102626L, 11103355L, 11109989L, 11110770L, 11111009L, 11112013L, 11112892L, 11113211L, 11113889L,
            11115526L, 11115951L, 11116870L, 11118832L, 11125226L, 11127027L, 11128605L, 11132770L, 11133311L, 11133313L, 11133501L, 11139123L,
            11139225L, 11150325L, 11150658L, 11150926L, 11151871L, 11151897L, 11152691L, 11155227L, 11155272L, 11156935L, 11157531L, 11157808L,
            11157870L, 11158915L, 11166193L, 11166329L, 11168666L, 11169771L, 11170662L, 11170866L, 11172580L, 11173095L, 11176610L, 11178699L,
            11182633L, 11183783L, 11186097L, 11187273L, 11190768L, 11191593L, 11192312L, 11192637L, 11193633L, 11198108L, 11198910L, 11201367L,
            11209185L, 11209339L, 11209357L, 11210596L, 11211280L, 11211857L, 11213093L, 11213781L, 11215991L, 11216115L, 11225799L, 11227781L,
            11230778L, 11231557L, 11231772L, 11235593L, 11236197L, 11236605L, 11238786L, 11239166L, 11239517L, 11251133L, 11251616L, 11252336L,
            11252602L, 11255619L, 11258273L, 11259702L, 11261778L, 11263680L, 11265532L, 11269529L, 11271157L, 11272188L, 11277179L, 11277550L,
            11277798L, 11280723L, 11281350L, 11283686L, 11285069L, 11285288L, 11289066L, 11291633L, 11295392L, 11295750L, 11296366L, 11297399L,
            11297906L, 11298056L, 11298807L, 11305160L, 11308702L, 11315008L, 11326362L, 11330792L, 11331583L, 11333337L, 11335382L, 11338785L,
            11362079L, 11363516L, 11372888L, 11377557L, 11537765L, 11559972L, 11560311L, 11573988L, 11591870L, 11598195L, 11655006L, 11659193L,
            11792371L, 11867752L, 11875560L, 11879135L, 11908811L, 12023726L, 12059971L, 12222530L, 12371730L, 12511713L, 12513302L, 12539023L,
            12562508L, 12632116L, 12725500L, 12766099L, 12777888L, 12821890L, 12863528L, 12871169L, 12962165L, 13052887L, 13123111L, 13237623L,
            13305999L, 13309055L, 13512756L, 13520669L, 13655982L, 13662858L, 13677206L, 13813962L, 13836799L, 13892503L, 13962253L, 15080183L,
            15152510L, 15316097L, 15578013L, 15669513L, 16052170L, 16661978L, 16729730L, 16818521L, 16900100L, 17051025L, 17163802L, 17193819L,
            17691517L, 17716136L, 17791199L, 17795857L, 17910850L, 17959993L, 17960838L, 17970993L, 18086608L, 18151222L, 18161310L, 18312677L,
            18359513L, 18569755L, 19081658L, 19886723L, 20051381L, 20072173L, 20239698L, 20300182L, 20581332L, 20597830L, 20702537L, 20712939L,
            20877856L, 21126798L, 21208230L, 21535577L, 21701070L, 21727382L, 22012386L, 22237311L, 22252922L, 22528785L, 22613167L, 22673807L,
            22851662L, 23296159L, 23306593L, 23869817L, 23896080L, 23960313L, 23972632L, 23992086L, 25118873L, 25167733L, 25216186L, 25518271L,
            25523515L, 25616622L, 25682888L, 25763570L, 25769689L, 25797692L, 25837566L, 25868819L, 26395722L, 26695266L, 26756957L, 26758189L,
            26759292L, 26852080L, 27670686L, 27679015L, 27695977L, 27712857L, 27795168L, 27872859L, 27962060L, 27969170L, 27971881L, 28062003L,
            28119120L, 28161578L, 28206503L, 28226098L, 28295577L, 28387011L, 28389308L, 28390011L, 28505357L, 28505510L, 28506606L, 28566932L,
            28570557L, 28582325L, 28665133L, 28717381L, 28737839L, 28738018L, 28751290L, 28753112L, 28753179L, 28753281L, 28753376L, 28753568L,
            28753700L, 28753937L, 28778397L, 28789182L, 28866029L, 28887013L, 28889282L, 28953138L, 29008303L, 29012977L, 29152355L, 29196691L,
            29201103L, 29222387L, 29261797L, 29318031L, 29335889L, 35022986L, 35024749L, 35031085L, 35046100L, 35054673L, 35082095L, 35114463L,
            35123700L, 35130229L, 35137478L, 35165165L, 35182465L, 35210176L, 35215051L, 35238730L, 35287620L, 35290926L, 35299064L, 35299269L,
            35305815L, 35354075L, 35368576L, 35398954L, 35411746L, 35412152L, 35442601L, 35461577L, 35464579L, 35478305L, 35524675L, 35568382L,
            35581927L, 35585300L, 35682445L, 35706838L, 35783651L, 35784022L, 35811577L, 35830038L, 35877655L, 35928659L, 35990202L, 36024108L,
            36038910L, 36076514L, 36132002L, 36132114L, 36136603L, 36140303L, 36152097L, 36166821L, 36173973L, 36190968L, 36196490L, 36221615L,
            36223918L, 36250298L, 36250937L, 36280914L, 36285434L, 36304544L, 36312953L, 36335482L, 36379152L, 36411597L, 36412281L, 36430703L,
            36432474L, 36460066L, 36475816L, 36481058L, 36496240L, 36561946L, 36589023L, 36598375L, 36600129L, 36619231L, 36624266L, 36656863L,
            36711063L, 36715586L, 36716144L, 36716755L, 36721952L, 36758137L, 36759173L, 36789475L, 36858410L, 36897936L, 36994068L, 37027679L,
            37103348L, 37123784L, 37358357L);
    @Resource
    private UserInfoMapper userInfoMapper;
    @Resource
    private UserMapper userMapper;
    @Resource
    private OldUserDataMapper oldUserDataMapper;
    @Resource
    private UserSecurityMapper userSecurityMapper;

    @Override
    @Trace
    public ReturnT<String> execute(String s) throws Exception {
        TrackingUtils.saveTraceId();
        log.info("updateDailyThreeFiledNewJobHandler.execute.countJobDailyWithdrawCap.start");
        if(StringUtils.isNotBlank(s)) {
            String[] userIdArr = s.split(",");
            List<String> userIdArray = Arrays.asList(userIdArr);
            for(String userIdStr:userIdArray){
                userIdList.add(Long.valueOf(userIdStr));
            }
        }
        log.info("updateDailyThreeFiledNewJobHandler:userIdList={}",userIdList);
        List<OldUserData> oldUserDatas = getOldUserDatas(userIdList);
        if (CollectionUtils.isEmpty(oldUserDatas)){
            log.info("getOldUserDatas.result null");
            return SUCCESS;
        }
        Map<String, BigDecimal> userIdMaxAssetMap = Maps.newHashMap();
        for(OldUserData oldUserData:oldUserDatas){
            if(null!=oldUserData.getWithdrawMaxAssetDay()){
                userIdMaxAssetMap.put(oldUserData.getUserId(),oldUserData.getWithdrawMaxAssetDay()) ;
            }
        }
        if (userIdMaxAssetMap == null || userIdMaxAssetMap.size() == 0){
            log.info("userIdMaxAssetMap is null");
            return SUCCESS;
        }
        List<UserInfo> userInfoList = userInfoMapper.selectUserInfoList(userIdList);
        if (CollectionUtils.isEmpty(userInfoList)){
            log.info("userInfoMapper.selectUserInfoList.result null");
            return SUCCESS;
        }
        List<UserInfo> zeroDailyWithdrawCapList = getZeroDailyWithdrawCap(userInfoList);
        for (UserInfo userInfo:zeroDailyWithdrawCapList){
            UserSecurity userSecurity = userSecurityMapper.selectByPrimaryKey(userInfo.getUserId());
            //非禁用
            if (userSecurity != null && userSecurity.getWithdrawSecurityAutoStatus() != 1 && userSecurity.getWithdrawSecurityStatus() != 1
                    && userIdMaxAssetMap.containsKey(String.valueOf(userInfo.getUserId()))){
                BigDecimal withdrawMaxAssetDay = userIdMaxAssetMap.get(String.valueOf(userInfo.getUserId()));
                if (withdrawMaxAssetDay != null && withdrawMaxAssetDay.doubleValue() > 0){
                    UserInfo param = new UserInfo();
                    param.setUserId(userInfo.getUserId());
                    param.setDailyWithdrawCap(withdrawMaxAssetDay);
                    int result = userInfoMapper.updateByPrimaryKeySelective(param);
                    log.info("updateDailyThreeFiledNewJobHandler.update.param:{},result:{}",param,result);
                }

            }
        }
        return SUCCESS;
    }



    private List<UserInfo> getZeroDailyWithdrawCap(List<UserInfo> userInfoList) {
        List<UserInfo> result = new ArrayList<>(userInfoList.size());
        for (UserInfo userInfo : userInfoList) {
            if (userInfo != null && userInfo.getUserId() != null && checkIsZero(userInfo.getDailyWithdrawCap())) {
                result.add(userInfo);
            }
        }
        return result;
    }

    private boolean checkIsZero(BigDecimal bigDecimal) {
        return bigDecimal == null || bigDecimal.doubleValue() == 0;
    }


    private List<OldUserData> getOldUserDatas(List<Long> list) {
        List<User> users = userMapper.selectByUserIds(list);
        if (CollectionUtils.isEmpty(users)) {
            log.info("updateDailyThreeFiledJobHandler.execute.selectByUserIds.result:{}", JsonUtils.toJsonHasNullKey(users));
            return Lists.newArrayList();
        }
        List<String> userIds = getUserIds(users);
        if (CollectionUtils.isEmpty(userIds)) {
            return Lists.newArrayList();
        }
        List<OldUserData> oldUserDatas = oldUserDataMapper.selectByUserIds(userIds);
        log.info("updateDailyThreeFiledJobHandler.execute.oldUserDatas.result:{}", JsonUtils.toJsonHasNullKey(oldUserDatas));
        if (CollectionUtils.isEmpty(oldUserDatas)) {
            return Lists.newArrayList();
        }
        return oldUserDatas;
    }


    private List<String> getUserIds(List<User> users) {
        List<String> result = new ArrayList<>(users.size());
        for (User user : users) {
            if (isNormalUser(user) && user.getUserId() != null) {
                result.add(String.valueOf(user.getUserId()));
            }
        }
        return result;
    }

    private boolean isNormalUser(User user) {
        return user != null && !BitUtils.isEnable(user.getStatus(), Constant.USER_IS_SUBUSER)
                && !BitUtils.isEnable(user.getStatus(), Constant.USER_IS_MARGIN_USER)
                && !BitUtils.isEnable(user.getStatus(), Constant.USER_IS_FUTURE_USER) && !BitUtils.isEnable(user.getStatus(), Constant.USER_DELETE);
    }
}
